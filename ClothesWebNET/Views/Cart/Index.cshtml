@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

@Styles.Render("~/Content/main")
@Styles.Render("~/Content/cart")  
<div class="container">
    <div class="breadcrumb">
        <div class="grid">
            <a href="./index.html">Trang chủ / </a>
            <a class="br-main" href="./cart.html">Giỏ hàng </a>
        </div>
    </div>
    <div class="grid">
        <div class="cart">
            <div class="cart-heading">
                <h2>Giỏ hàng của bạn</h2>
                <h3>Có <span class="count-cart" id="qty">5 </span>  sản phẩm trong giỏ hàng</h3>
            </div>
            <div class="product-cart">
                <div class="cart-list-product" id="renderBody">   </div>



                <div class="cart-info-product">
                    <div class="cart-info-title">
                        Thông tin đơn hàng
                    </div>
                    <div class="cart-info-total-money">
                        <div class="info-total-title" id="totalMoney">Tổng tiền:</div>
                        <div class="info-total-money"></div>
                    </div>
                    <p class="cart-info-note">
                        Phí vận chuyển sẽ được tính ở trang thanh toán.
                        Bạn cũng có thể nhập mã giảm giá ở trang thanh toán.
                    </p>
                    <button class="button-hover button-payment">THANH TOÁN</button>
                    <p class="back-home"><a href="/product.html" class="link-back-home"><i class='bx bxs-chevron-left'></i> Tiếp tục mua hàng</a></p>
                </div>
            </div>
            <div class="product-note">
                <div class="note">
                    <h4>Ghi chú đơn hàng</h4>
                    <textarea class="text-note" placeholder="Ghi chú"></textarea>
                </div>
                <div class="policy">
                    <h4>Chính sách đổi hàng</h4>
                    <ul class="list-policy">
                        <li>- Sản phẩm được đổi 1 lần duy nhất, không hỗ trợ trả.</li>
                        <li>- Sản phẩm còn đủ tem mác, chưa qua sử dụng.</li>
                        <li>- Sản phẩm được đổi trong vòng 7 ngày trên toàn hệ thống ZOMBIE.</li>
                        <li>- Sản phẩm sale KHÔNG hỗ trợ đổi size.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!-- Product end -->


</div>

@Scripts.Render("~/bundles/cart")
@Scripts.Render("~/bundles/calculate")
<script>
    let listCart = JSON.parse(window.localStorage.getItem('cart'));
    let totalMoney = document.getElementById('totalMoney');
    let qty = document.getElementById('qty');
    
    function renderTable(dataList) {
        $(document).ready(() => {
            let str = ''
            let total = 0
            let count=0;
            dataList.forEach((el, index) => {
                count++
            let intoMoney = Number(el['price']) * Number(el['amount'])
            let bodyCart = `
                     <div class="cart-product-item">
                            <img src="${el['img']}" alt="" class="item-img">
                            <div class="item-info">
                                <div class="info-heading">
                                    <div class="heading-title">${el['title']}</div>
                                    <div class="heading-close" onclick="remove('${el['title']}','${el['size']}',event)">✖</div>
                                </div>
                                <div class="info-price">${el['price']},000 VND</div>
                                <div class="info-price">${el['size']}</div>
                                <div class="info-total">
                                    <div class="total-amount">
                                        <button class="button-amount button-minus" onclick="clickMinus('${el['title']}','${el['size']}',event)"/>-</button>
                                        <input type="number" class="input-amout" readonly min="1" value="${el['amount']}" />
                                        <button class="button-amount button-add" onclick="clickAdd('${el['title']}','${el['size']}',event)">+</button>
                                    </div>
                                    <div class="total-money">
                                    ${intoMoney.toLocaleString()},000 VND
                                    </div>
                                </div>
                            </div>
                        </div>
            `
              total += intoMoney
              str += bodyCart
            })
            console.log(count)
            qty.innerHTML = count
            totalMoney.innerHTML = total.toLocaleString() + ",000 VND";
            $('#renderBody').html(str)
        })
    }


    renderTable(listCart);
    function clickMinus(title,size, e) {
       let cart = JSON.parse(window.localStorage.getItem('cart'));
        cart.forEach((el)=>{
            if(el['title']===title && el['size'] === size)
            {
                if (el['amount'] > 1) {
                    el['amount'] -= 1;
                }
                else {
                    alert("Số lượng giảm trên 1")
                }
        
            }
        })
        window.localStorage.setItem('cart', JSON.stringify(cart));
        let total = 0
        listCart.forEach((el) => {
            let intoMoney = Number(el['price']) * Number(el['amount'])
            total += intoMoney
        })
        totalMoney.innerHTML = total.toLocaleString() + ",000 VND";
       renderTable(cart);
    }
    function clickAdd(title, size, e) {
        let cart = JSON.parse(window.localStorage.getItem('cart'));
        cart.forEach((el) => {
            if (el['title'] === title && el['size'] === size) {
             
                    el['amount'] += 1;
             

            }
        })
        window.localStorage.setItem('cart', JSON.stringify(cart));

        renderTable(cart);
    }
    function remove(title, size, e) {
        let cart = JSON.parse(window.localStorage.getItem('cart'));
        const cartNew = cart.filter((el) => {

            return el['title'] !== title
        })
        cartNew.filter((el) => {
            return el['size'] !== size
        })
       window.localStorage.setItem('cart', JSON.stringify(cartNew));

        renderTable(cartNew);
    }
</script>

